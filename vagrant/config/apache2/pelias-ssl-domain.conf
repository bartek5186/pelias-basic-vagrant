<VirtualHost *:80>
        ServerName geo.domain.com
        ServerAlias www.domain.com
        ServerAdmin system@domain.com

        RewriteEngine on
        RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R=301,L]
</VirtualHost>
<VirtualHost *:80>
        ServerName pip.domain.com
        ServerAlias www.pip.domain.com
        ServerAdmin system@domain.com

        RewriteEngine on
        RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R=301,L]
</VirtualHost>
<VirtualHost *:80>
        ServerName libpostal.domain.com
        ServerAlias www.libpostal.domain.com
        ServerAdmin system@domain.com

        RewriteEngine on
        RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R=301,L]
</VirtualHost>
<VirtualHost *:443>
        ServerName geo.domain.com
        ServerAlias www.geo.domain.com
        ServerAdmin system@domain.com

        CustomLog ${APACHE_LOG_DIR}/domain.geo.access.log combined
        ErrorLog ${APACHE_LOG_DIR}/domain.geo.error.log

        SSLEngine on
        SSLCertificateKeyFile /certs/domain.key
        SSLCertificateFile /certs/domain.crt
        SSLCACertificateFile /certs/intermediate-ca.crt

        SSLProxyEngine on
        SSLProxyCACertificateFile /certs/intermediate-ca.crt

        ProxyRequests On
        ProxyPreserveHost On
        ProxyVia full

        ProxyPass / http://geo.domain.com:3100/
        ProxyPassReverse / http://geo.domain.com:3100/

</VirtualHost>
<VirtualHost *:443>
        ServerName pip.domain.com
        ServerAlias www.pip.domain.com
        ServerAdmin system@domain.com

        CustomLog ${APACHE_LOG_DIR}/domain.pip.access.log combined
        ErrorLog ${APACHE_LOG_DIR}/domain.pip.error.log

        SSLEngine on
        SSLCertificateKeyFile /certs/domain.key
        SSLCertificateFile /certs/domain.crt
        SSLCACertificateFile /certs/intermediate-ca.crt

        SSLProxyEngine on
        SSLProxyCACertificateFile /certs/intermediate-ca.crt

        ProxyRequests On
        ProxyPreserveHost On
        ProxyVia full

        ProxyPass / http://pip.domain.com:3102/
        ProxyPassReverse / http://pip.domain.com:3102/
</VirtualHost>
<VirtualHost *:443>
         ServerName libpostal.domain.com
         ServerAlias www.libpostal.domain.com
         ServerAdmin system@domain.com

         CustomLog ${APACHE_LOG_DIR}/domain.libpostal.access.log combined
         ErrorLog ${APACHE_LOG_DIR}/domain.libpostal.error.log

         SSLEngine on
         SSLCertificateKeyFile /certs/domain.key
         SSLCertificateFile /certs/domain.crt
         SSLCACertificateFile /certs/intermediate-ca.crt

         SSLProxyEngine on
         SSLProxyCACertificateFile /certs/intermediate-ca.crt

         ProxyRequests On
         ProxyPreserveHost On
         ProxyVia full

         ProxyPass / http://libpostal.domain.com:8080/
         ProxyPassReverse / http://libpostal.domain.com:8080/
 </VirtualHost>
